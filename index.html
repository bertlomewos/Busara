<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Busara</title>

<style>
  * { margin:0; padding:0; }
  html, body { width:100%; height:100%; background:#000; overflow:hidden; }
  #unity-container { position:absolute; left:0; top:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; }
  #unity-canvas { width:100%; height:100%; background:#000; }

  #unity-loading-container { position:absolute; left:0; top:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:40px; background:#000; opacity:1; visibility:visible; transition:800ms linear; }
  #unity-loading-container.finished { opacity:0; visibility:collapse; }
  #unity-loading-container .logo { width:15%; height:15%; }

  #unity-loading-bar { position:relative; width:40%; height:10px; background:#333; border-radius:10px; overflow:hidden; }
  #unity-loading-bar-inner { position:absolute; left:0; top:0; width:1%; height:100%; background:#ccc; transition:400ms linear; }

  #rotate-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); color:white; display:none; align-items:center; justify-content:center; flex-direction:column; z-index:9999; font-family:sans-serif; }
  #rotate-overlay img { width:100px; margin-bottom:20px; }
</style>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <div id="unity-container">
    <canvas id="unity-canvas"></canvas>
  </div>

  <div id="unity-loading-container">
    <img src="logo.svg" class="logo" alt="Logo efuyegela">
    <div id="unity-loading-bar">
      <div id="unity-loading-bar-inner"></div>
    </div>
  </div>

  <div id="rotate-overlay">
    <p>Please rotate your device</p>
  </div>

<script>
  // Telegram WebApp
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand(); // request max height
  tg.setBackgroundColor("#000"); // blend Telegram UI
  tg.MainButton.setText("Play");
  tg.MainButton.show();
  tg.disableVerticalSwipes();

  // Orientation lock & rotate overlay
  function lockLandscape() {
    if (screen.orientation && screen.orientation.lock) {
      screen.orientation.lock("landscape").catch(err => console.log(err));
    }
  }
  function checkOrientation() {
    const overlay = document.getElementById("rotate-overlay");
    if(window.innerHeight > window.innerWidth) overlay.style.display="flex";
    else overlay.style.display="none";
  }
  window.addEventListener("resize", checkOrientation);
  window.addEventListener("orientationchange", checkOrientation);
  document.addEventListener("click", lockLandscape, {once:true});
  document.addEventListener("touchstart", lockLandscape, {once:true});
  checkOrientation();

  // Unity Loader
  window.addEventListener("load", function () {
    if("serviceWorker" in navigator) navigator.serviceWorker.register("ServiceWorker.js");
  });

  var buildUrl = "Build";
  var loaderUrl = buildUrl + "/6da609f603b876dfa5c8e7d6d2ea6c35.loader.js";
  var config = {
    dataUrl: buildUrl + "/0e4bf3e6335e74c5d452cd593a669cf3.data",
    frameworkUrl: buildUrl + "/7397bd1a81bfb6a50a72623ea0cd0b10.framework.js",
    codeUrl: buildUrl + "/b9b65e607d67deb59bf6827c9406fbaf.wasm",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "efuyegela",
    productName: "Busara",
    productVersion: "1.0"
  };

  if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    config.devicePixelRatio = Math.min(window.devicePixelRatio,2.0);
  }

  var canvas = document.querySelector("#unity-canvas");
  var loadingContainer = document.querySelector("#unity-loading-container");
  var loadingBar = document.querySelector("#unity-loading-bar-inner");

  var script = document.createElement("script");
  script.src = loaderUrl;
  script.onload = function() {
    createUnityInstance(canvas, config, function(progress){
      loadingBar.style.width = 100*progress+"%";
    }).then(function(unityInstance){
      loadingContainer.classList.add("finished");
    }).catch(function(err){ alert(err); });
  };
  document.body.appendChild(script);
</script>
</body>
</html>
